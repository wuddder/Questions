<!doctype html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Peripheral Third Phase</title>
<style>
div#padding-dic {
    height: 1200px;
}
</style>
</head>

<body bgcolor="black">
    <div id="padding-dic"></div>
    <div id="control-panel" style="position: absolute; top: 1250px;">
        <legend>Start?</legend>
        <button id='startbtm' onclick="userStudy.start()">Start</button>
        <legend>See?</legend>
        <button onclick="userStudy.nextCharacter('yes');">See</button>
        <button onclick="userStudy.nextCharacter('no');">!See</button>
    </div>
    <svg id="mainSVG">
    </svg>
    <script type="text/javascript" src="util.js"></script>
    <script type="text/javascript" src="Canvas.js"></script>
    <script type="text/javascript" src="Experiment.js"></script>
    <script type="text/javascript" src="PilotStudy.js"></script>
    <script type="text/javascript" src="UserStudy1.js"></script>
    <script type="text/javascript" src="UserStudy2.js"></script>
    <script type="text/javascript" src="smil.user.js"></script>
    <script src="http://cdn.peerjs.com/0.3/peer.js"></script>
    <script>
    var canvas = new Canvas("mainSVG");
    var exp = new Experiment(canvas);
    var userStudy = new UserStudy2(exp);
    </script>
    <script>
    window.addEventListener('keydown', function(e) {
        //  console.log(e);
        if (e.keyCode == 81) {
            console.log("See");
            userStudy.nextCharacter('yes');
        }
        if (e.keyCode == 87) {
            console.log("!See");
            userStudy.nextCharacter('no');
        }
    });
    </script>
    <script>
    window.addEventListener('keydown', function(e) {
        //  console.log(e);
        if (e.keyCode == 81) {
            console.log("See");
            userStudy.nextCharacter('yes');
        }
        if (e.keyCode == 87) {
            console.log("!See");
            userStudy.nextCharacter('no');
        }
    });


    var peer = new Peer('steven-phase-3', {key: '4egxlr70bg0q9f6r'});

    // handle error
    peer.on('error', function(error) {
        console.log('Peer error', error);
    });

    // connecting
    // var conn = peer.connect('steven-test-peer-1');
    var conn = null;

    function _send(msg) {
        conn.send(msg);
    }

    peer.on('connection', function(connection) {
        conn = connection;
        conn.send("connected with you!");
        console.log("connection established!");
        conn.on('data', function(data) {
            // display on the screen
            console.log("receiving: " + data);
            if(data == 'yes')
                userStudy.nextCharacter('yes');
            else
                userStudy.nextCharacter('no');
        });
    });

    function send() {
        var s = document.getElementById('input-text-box').value;
        if(s.length > 0 && conn != null) {
            _send(s);
            document.getElementById('input-text-box').value = "";
        }
    }

    userStudy.setSendFunction(_send);
   
    </script>
    </script>
</body>

</html>
